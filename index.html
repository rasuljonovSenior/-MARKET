<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Macro Supermarket | Boshqaruv Tizimi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#0F766E",
              secondary: "#0E7490",
              accent: "#0284C7",
              success: "#16A34A",
              warning: "#CA8A04",
              danger: "#DC2626",
              info: "#2563EB",
              light: "#F8FAFC",
              dark: "#0F172A",
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
            boxShadow: {
              card: "0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f1f5f9;
      }
      .transition-all {
        transition: all 0.3s ease;
      }
      .hover-scale {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .hover-scale:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .sidebar-item {
        transition: all 0.2s ease;
      }
      .sidebar-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .sidebar-item.active {
        background-color: rgba(255, 255, 255, 0.2);
        border-left: 4px solid white;
      }
      .modal-overlay {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .animate-fadeIn {
        animation: fadeIn 0.3s ease-in-out;
      }
      .notification {
        animation: slideIn 0.3s ease-out forwards;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      .slide-out {
        animation: slideOut 0.3s ease-in forwards;
      }
      .badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #dc2626;
        color: white;
        border-radius: 9999px;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .current-time {
        font-size: 1.1rem;
        font-weight: 600;
        color: #0F766E;
      }
    </style>
  </head>
  <body class="bg-gray-100">
     <!-- ðŸ” Login formasi -->
  <div id="login-screen" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-sm">
      <h2 class="text-2xl font-bold text-center text-primary mb-6">Tizimga Kirish</h2>
      <div class="space-y-4">
        <input
          type="text"
          id="login-username"
          placeholder="Login"
          class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        />
        <input
          type="password"
          id="login-password"
          placeholder="Parol"
          class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        />
        <p id="login-error" class="text-danger text-sm hidden">Login yoki parol notoâ€˜gâ€˜ri</p>
        <button
          onclick="login()"
          class="w-full bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium"
        >
          Kirish
        </button>
      </div>
    </div>
  </div>
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="bg-primary text-white w-64 flex-shrink-0 hidden md:block"
      >
        <div class="p-4 border-b border-white/20">
          <h1 class="text-2xl font-bold flex items-center">
            <i class="fas fa-shopping-cart mr-3"></i>
            Ð® Market
          </h1>
          <p class="text-xs text-white/70 mt-1">Boshqaruv Tizimi v1.0</p>
          <!-- Real-time clock -->
          <div class="mt-3 p-2 bg-white/10 rounded-lg">
            <div class="text-xs text-white/70">Joriy vaqt:</div>
            <div id="current-time" class="text-sm font-medium text-white"></div>
          </div>
        </div>
        <nav class="mt-4">
          <ul>
            <li>
              <a
                href="#"
                onclick="showSection('home')"
                class="sidebar-item active flex items-center p-3 pl-4"
              >
                <i class="fas fa-home w-6"></i>
                <span>Bosh Sahifa</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('kassa')"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-cash-register w-6"></i>
                <span>Kassa</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('ombor')"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-warehouse w-6"></i>
                <span>Ombor</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('hisobotlar')"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-chart-line w-6"></i>
                <span>Hisobotlar</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('qarzdorlar')"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-user-friends w-6"></i>
                <span>Qarzdorlar</span>
              </a>
            </li>
          </ul>
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t border-white/20">
          <div class="flex items-center">
            <div
              class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"
            >
              <i class="fas fa-user"></i>
            </div>
            <div class="ml-3">
              <p class="font-medium">Admin</p>
              <p class="text-xs text-white/70">admin@macro.uz</p>
            </div>
          </div>
        </div>
      </aside>

      <!-- Mobile Sidebar Toggle -->
      <div
        id="sidebar-overlay"
        class="fixed inset-0 bg-black/50 z-20 hidden"
        onclick="toggleMobileSidebar()"
      ></div>

      <div
        id="mobile-sidebar"
        class="fixed inset-y-0 left-0 w-64 bg-primary text-white z-30 transform -translate-x-full transition-transform duration-300 md:hidden"
      >
        <div class="p-4 border-b border-white/20">
          <div class="flex justify-between items-center">
            <h1 class="text-xl font-bold">Macro Market</h1>
            <button onclick="toggleMobileSidebar()" class="text-white">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <p class="text-xs text-white/70 mt-1">Boshqaruv Tizimi v1.0</p>
          <!-- Real-time clock for mobile -->
          <div class="mt-3 p-2 bg-white/10 rounded-lg">
            <div class="text-xs text-white/70">Joriy vaqt:</div>
            <div id="mobile-current-time" class="text-sm font-medium text-white"></div>
          </div>
        </div>
        <nav class="mt-4">
          <ul>
            <li>
              <a
                href="#"
                onclick="showSection('home'); toggleMobileSidebar();"
                class="sidebar-item active flex items-center p-3 pl-4"
              >
                <i class="fas fa-home w-6"></i>
                <span>Bosh Sahifa</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('kassa'); toggleMobileSidebar();"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-cash-register w-6"></i>
                <span>Kassa</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('ombor'); toggleMobileSidebar();"
                class="sidebar-item flex items-center p-3 pl-4"
              >
              <i class="fas fa-warehouse w-6"></i>
                <span>Ombor</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('hisobotlar'); toggleMobileSidebar();"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-chart-line w-6"></i>
                <span>Hisobotlar</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                onclick="showSection('qarzdorlar'); toggleMobileSidebar();"
                class="sidebar-item flex items-center p-3 pl-4"
              >
                <i class="fas fa-user-friends w-6"></i>
                <span>Qarzdorlar</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Main Content -->
      <main class="flex-1 overflow-y-auto">
        <!-- Top Navbar -->
        <header class="bg-white shadow-sm">
          <div class="flex justify-between items-center p-4">
            <button
              onclick="toggleMobileSidebar()"
              class="md:hidden text-gray-700"
            >
              <i class="fas fa-bars text-xl"></i>
            </button>
            <h2
              id="page-title"
              class="text-xl font-semibold text-gray-800 md:ml-0 ml-4"
            >
              Bosh Sahifa
            </h2>
            <div class="flex items-center space-x-4">
              <!-- Current time display in header -->
              <div class="hidden md:block text-right">
                <div class="text-xs text-gray-500">Joriy vaqt</div>
                <div id="header-current-time" class="current-time"></div>
              </div>
              <div class="relative">
                <button class="text-gray-600 hover:text-gray-800">
                  <i class="fas fa-bell text-xl"></i>
                  <span class="badge">3</span>
                </button>
              </div>
              <div class="relative">
                <button class="text-gray-600 hover:text-gray-800">
                  <i class="fas fa-cog text-xl"></i>
                </button>
              </div>
            </div>
          </div>
        </header>

        <!-- Content Sections -->
        <div class="p-4 md:p-6">
          <!-- Bosh Sahifa -->
          <section id="home" class="animate-fadeIn">
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
            >
              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center text-primary"
                  >
                    <i class="fas fa-shopping-cart text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Bugungi Sotuvlar
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="today-sales"
                    >
                      0
                    </p>
                  </div>
                </div>
                <div class="mt-4 text-sm text-success flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  <span id="sales-increase">0%</span>
                  <span class="text-gray-500 ml-1">o'tgan kunga nisbatan</span>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-secondary/20 flex items-center justify-center text-secondary"
                  >
                    <i class="fas fa-box text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Mahsulotlar
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="products-count"
                    >
                      0
                    </p>
                  </div>
                </div>
                <div class="mt-4 text-sm text-warning flex items-center">
                  <i class="fas fa-exclamation-triangle mr-1"></i>
                  <span id="low-stock-count">0</span>
                  <span class="text-gray-500 ml-1">kam qoldiq</span>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent"
                  >
                    <i class="fas fa-user-friends text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Qarzdorlar
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="debtors-count"
                    >
                      0
                    </p>
                  </div>
                </div>
                <div class="mt-4 text-sm text-danger flex items-center">
                  <i class="fas fa-money-bill-wave mr-1"></i>
                  <span id="total-debt-amount">0</span>
                  <span class="text-gray-500 ml-1">UZS</span>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-success/20 flex items-center justify-center text-success"
                  >
                    <i class="fas fa-chart-line text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Oylik Daromad
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="monthly-income"
                    >
                      0
                    </p>
                  </div>
                </div>
                <div class="mt-4 text-sm text-success flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  <span id="income-increase">0%</span>
                  <span class="text-gray-500 ml-1">o'tgan oyga nisbatan</span>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div class="lg:col-span-2 bg-white rounded-xl shadow-card p-6">
                <div class="flex justify-between items-center mb-6">
                  <h3 class="text-lg font-semibold text-gray-800">
                    So'nggi Sotuvlar
                  </h3>
                  <a
                    href="#"
                    onclick="showSection('hisobotlar')"
                    class="text-primary text-sm hover:underline"
                    >Barchasini ko'rish</a
                  >
                </div>
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                      <tr>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          ID
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Sana/Vaqt
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Mahsulotlar
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          To'lov
                        </th>
                        <th
                          class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                          Summa
                        </th>
                      </tr>
                    </thead>
                    <tbody
                      id="recent-sales"
                      class="bg-white divide-y divide-gray-200"
                    >
                      <!-- JavaScript tomonidan to'ldiriladi -->
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex justify-between items-center mb-6">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Kam Qoldiq
                  </h3>
                  <a
                    href="#"
                    onclick="showSection('ombor')"
                    class="text-primary text-sm hover:underline"
                    >Barchasini ko'rish</a
                  >
                </div>
                <div id="low-stock-products" class="space-y-4">
                  <!-- JavaScript tomonidan to'ldiriladi -->
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-6">
              <div class="md:col-span-4 bg-white rounded-xl shadow-card p-6">
                <div class="flex justify-between items-center mb-6">
                  <h3 class="text-lg font-semibold text-gray-800">
                    Tezkor Harakatlar
                  </h3>
                </div>
                <div
                  class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"
                >
                  <button
                    onclick="showSection('kassa')"
                    class="hover-scale bg-primary text-white rounded-xl p-4 flex flex-col items-center justify-center h-32"
                  >
                    <i class="fas fa-cash-register text-3xl mb-2"></i>
                    <span class="text-lg font-medium">Yangi Sotuv</span>
                  </button>
                  <button
                    onclick="openProductModal()"
                    class="hover-scale bg-secondary text-white rounded-xl p-4 flex flex-col items-center justify-center h-32"
                  >
                    <i class="fas fa-box-open text-3xl mb-2"></i>
                    <span class="text-lg font-medium">Mahsulot Qo'shish</span>
                  </button>
                  <button
                    onclick="showSection('hisobotlar')"
                    class="hover-scale bg-accent text-white rounded-xl p-4 flex flex-col items-center justify-center h-32"
                  >
                    <i class="fas fa-file-invoice text-3xl mb-2"></i>
                    <span class="text-lg font-medium">Hisobotlar</span>
                  </button>
                  <button
                    onclick="showSection('qarzdorlar')"
                    class="hover-scale bg-warning text-white rounded-xl p-4 flex flex-col items-center justify-center h-32"
                  >
                    <i class="fas fa-user-friends text-3xl mb-2"></i>
                    <span class="text-lg font-medium">Qarzdorlar</span>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Kassa Bo'limi -->
          <section id="kassa" class="hidden animate-fadeIn">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Savat - Moved to the top -->
              <div class="bg-white rounded-xl shadow-card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                  <i class="fas fa-shopping-cart mr-2 text-primary"></i>Savat
                </h3>
                <div
                  class="max-h-96 overflow-y-auto scrollbar-hide mb-4"
                  id="cart-items"
                >
                  <!-- JavaScript tomonidan to'ldiriladi -->
                </div>
                <div class="border-t border-gray-200 pt-4 mt-4">
                  <div class="flex justify-between font-bold text-lg">
                    <span>Jami:</span>
                    <span id="cart-total" class="text-primary">0 UZS</span>
                  </div>

                  <div class="grid grid-cols-2 gap-4 mt-6">
                    <button
                      id="pay-cash"
                      class="bg-success hover:bg-success/90 text-white px-4 py-3 rounded-lg font-medium transition-all flex items-center justify-center"
                    >
                      <i class="fas fa-money-bill mr-2"></i>Naqd
                    </button>
                    <button
                      id="pay-debt"
                      class="bg-warning hover:bg-warning/90 text-white px-4 py-3 rounded-lg font-medium transition-all flex items-center justify-center"
                    >
                      <i class="fas fa-handshake mr-2"></i>Qarzdorlik
                    </button>
                  </div>

                  <div
                    id="debt-form"
                    class="hidden mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200"
                  >
                    <h4 class="font-medium text-gray-800 mb-3">
                      Qarzdor ma'lumotlari
                    </h4>
                    <div class="space-y-3">
                      <div class="relative">
                        <i
                          class="fas fa-user absolute left-3 top-3 text-gray-400"
                        ></i>
                        <input
                          type="text"
                          id="debtor-firstname"
                          placeholder="Ism"
                          class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                        />
                      </div>
                      <div class="relative">
                        <i
                          class="fas fa-user absolute left-3 top-3 text-gray-400"
                        ></i>
                        <input
                          type="text"
                          id="debtor-lastname"
                          placeholder="Familiya"
                          class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                        />
                      </div>
                      <div class="relative">
                        <i
                          class="fas fa-phone absolute left-3 top-3 text-gray-400"
                        ></i>
                        <input
                          type="tel"
                          id="debtor-phone"
                          placeholder="Telefon raqami"
                          class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                        />
                      </div>
                    </div>
                    <p class="font-medium text-warning mt-3">
                      <i class="fas fa-handshake mr-2"></i>Qarz miqdori:
                      <span id="debt-amount">0</span> UZS
                    </p>
                    <button
                      id="complete-debt-sale"
                      class="bg-success hover:bg-success/90 text-white px-4 py-3 mt-4 rounded-lg font-medium transition-all w-full flex items-center justify-center"
                    >
                      <i class="fas fa-check mr-2"></i>Qarzdorlikni Yakunlash
                    </button>
                  </div>
                </div>
              </div>

              <!-- Qidiruv va Mahsulotlar Ro'yxati -->
              <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-card p-6 mb-6">
                  <div class="relative">
                    <i
                      class="fas fa-search absolute left-3 top-3 text-gray-400"
                    ></i>
                    <input
                      type="text"
                      id="search"
                      placeholder="Mahsulot qidirish..."
                      class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    />
                  </div>
                </div>

                <div class="bg-white rounded-xl shadow-card p-6">
                  <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    Mahsulotlar
                  </h3>
                  <div
                    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"
                    id="products-list"
                  >
                    <!-- JavaScript tomonidan to'ldiriladi -->
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Ombor Bo'limi -->
          <section id="ombor" class="hidden animate-fadeIn">
            <div class="bg-white rounded-xl shadow-card p-6 mb-6">
              <div
                class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
              >
                <h2 class="text-xl font-semibold text-gray-800">
                  Ombor Boshqaruvi
                </h2>
                <div class="flex gap-3">
                  <div class="relative">
                    <i
                      class="fas fa-search absolute left-3 top-3 text-gray-400"
                    ></i>
                    <input
                      type="text"
                      id="stock-search"
                      placeholder="Mahsulot qidirish..."
                      class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    />
                  </div>
                  <button
                    id="open-product-modal"
                    class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center"
                  >
                    <i class="fas fa-plus mr-2"></i>Mahsulot Qo'shish
                  </button>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-card p-6">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead>
                    <tr>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        ID
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Mahsulot
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Turi
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Narxi
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Qoldiq
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Birlik
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Amallar
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="stock-table"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- JavaScript tomonidan to'ldiriladi -->
                  </tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- Hisobotlar Bo'limi -->
          <section id="hisobotlar" class="hidden animate-fadeIn">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center text-primary"
                  >
                    <i class="fas fa-money-bill-wave text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Umumiy Sotuvlar
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="total-sales"
                    >
                      0 UZS
                    </p>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-secondary/20 flex items-center justify-center text-secondary"
                  >
                    <i class="fas fa-box text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Sotilgan Mahsulotlar
                    </h3>
                    <p
                      class="text-2xl font-bold text-gray-800"
                      id="total-items"
                    >
                      0
                    </p>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center">
                  <div
                    class="w-12 h-12 rounded-full bg-warning/20 flex items-center justify-center text-warning"
                  >
                    <i class="fas fa-handshake text-xl"></i>
                  </div>
                  <div class="ml-4">
                    <h3 class="text-sm font-medium text-gray-500">
                      Umumiy Qarzdorlik
                    </h3>
                    <p class="text-2xl font-bold text-gray-800" id="total-debt">
                      0 UZS
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-card p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-800">
                  Sotuvlar Tarixi
                </h3>
                <div class="flex gap-3">
                  <div class="relative">
                    <i
                      class="fas fa-calendar absolute left-3 top-3 text-gray-400"
                    ></i>
                    <input
                      type="date"
                      id="sales-date-filter"
                      class="p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    />
                  </div>
                  <select
                    id="payment-type-filter"
                    class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  >
                    <option value="all">Barcha to'lovlar</option>
                    <option value="Naqd">Naqd</option>
                    <option value="Qarzdorlik">Qarzdorlik</option>
                  </select>
                </div>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead>
                    <tr>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        ID
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Sana/Vaqt
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Mahsulotlar
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        To'lov Turi
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Summa
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Amallar
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="sales-history"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- JavaScript tomonidan to'ldiriladi -->
                  </tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- Qarzdorlar Bo'limi -->
          <section id="qarzdorlar" class="hidden animate-fadeIn">
            <div class="bg-white rounded-xl shadow-card p-6 mb-6">
              <div
                class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
              >
                <h2 class="text-xl font-semibold text-gray-800">
                  Qarzdorlar Ro'yxati
                </h2>
                <div class="relative">
                  <i
                    class="fas fa-search absolute left-3 top-3 text-gray-400"
                  ></i>
                  <input
                    type="text"
                    id="debtors-search"
                    placeholder="Qarzdor qidirish..."
                    class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  />
                </div>
              </div>
            </div>

            <div class="bg-white rounded-xl shadow-card p-6">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead>
                    <tr>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        ID
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Ism Familiya
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Telefon
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Qarz Miqdori
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Sana/Vaqt
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Amallar
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="debtors-table"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- JavaScript tomonidan to'ldiriladi -->
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Mahsulot Qo'shish Modali -->
    <div
      id="product-modal"
      class="fixed inset-0 modal-overlay hidden flex items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md animate-fadeIn"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">
            <i class="fas fa-box-open mr-2 text-primary"></i>
            <span id="modal-title">Yangi Mahsulot Qo'shish</span>
          </h3>
          <button
            id="close-product-modal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="space-y-4">
          <input type="hidden" id="edit-product-id" value="" />
          <div class="relative">
            <i class="fas fa-box absolute left-3 top-3 text-gray-400"></i>
            <input
              type="text"
              id="modal-product-name"
              placeholder="Mahsulot nomi"
              class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Mahsulot turi</label
            >
            <select
              id="modal-product-type"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            >
              <option value="other">Tanlang</option>
              <option value="drink">Ichimlik</option>
              <option value="food">Oziq-ovqat</option>
              <option value="fruit">Meva</option>
              <option value="sweets">Shirinlik</option>
              <option value="snacks">Sneklar</option>
              <option value="vegetable">Sabzavot</option>
            </select>
          </div>

          <div id="volume-container" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Hajmi</label
            >
            <input
            type="number"
            step="0.1"
            id="modal-product-volume"
            placeholder="Masalan: 0.3, 0.75, 5 (L)"
            class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          />
          
          </div>

          <div id="weight-container" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Og'irligi (gramm)</label
            >
            <select
              id="modal-product-weight"
              class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            >
              <option value="50">50gr</option>
              <option value="100">100gr</option>
              <option value="150">150gr</option>
              <option value="200">200gr</option>
              <option value="250">250gr</option>
              <option value="300">300gr</option>
              <option value="400">400gr</option>
              <option value="500">500gr</option>
              <option value="750">750gr</option>
              <option value="1000">1000gr</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >O'lchov birligi</label
            >
            <div class="flex space-x-4">
              <label class="flex items-center">
                <input
                  type="radio"
                  name="unit"
                  value="kg"
                  id="unit-kg"
                  class="mr-2 text-primary focus:ring-primary"
                />
                <span>Kg</span>
              </label>
              <label class="flex items-center">
                <input
                  type="radio"
                  name="unit"
                  value="sanoq"
                  id="unit-sanoq"
                  class="mr-2 text-primary focus:ring-primary"
                />
                <span>Sanoq</span>
              </label>
            </div>
          </div>

          <div class="relative">
            <i
              class="fas fa-balance-scale absolute left-3 top-3 text-gray-400"
            ></i>
            <input
              type="number"
              id="modal-product-quantity"
              placeholder="Miqdor (kg yoki dona)"
              step="0.1"
              class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>

          <div class="relative">
            <i class="fas fa-tag absolute left-3 top-3 text-gray-400"></i>
            <input
              type="number"
              id="modal-product-price"
              placeholder="Narxi (1 kg yoki 1 dona uchun, UZS)"
              class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
        </div>

        <div class="flex space-x-3 mt-6">
          <button
            id="save-product"
            class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-save mr-2"></i>Saqlash
          </button>
          <button
            id="cancel-product"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-times mr-2"></i>Bekor Qilish
          </button>
        </div>
      </div>
    </div>

    <!-- Mahsulot Miqdorini Yangilash Modali -->
    <div
      id="update-stock-modal"
      class="fixed inset-0 modal-overlay hidden flex items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md animate-fadeIn"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">
            <i class="fas fa-sync mr-2 text-primary"></i>
            <span>Mahsulot Qoldiqini Yangilash</span>
          </h3>
          <button
            id="close-update-stock-modal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="space-y-4">
          <input type="hidden" id="update-product-id" value="" />
          <p class="text-gray-700">
            Mahsulot: <span id="update-product-name" class="font-medium"></span>
          </p>
          <p class="text-gray-700">
            Joriy qoldiq:
            <span id="update-current-stock" class="font-medium"></span>
          </p>

          <div class="relative">
            <i
              class="fas fa-balance-scale absolute left-3 top-3 text-gray-400"
            ></i>
            <input
              type="number"
              id="update-stock-quantity"
              placeholder="Yangi miqdor"
              step="0.1"
              class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
        </div>

        <div class="flex space-x-3 mt-6">
          <button
            id="save-stock-update"
            class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-save mr-2"></i>Saqlash
          </button>
          <button
            id="cancel-stock-update"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-times mr-2"></i>Bekor Qilish
          </button>
        </div>
      </div>
    </div>

    <!-- Sotuv Tafsilotlari Modali -->
    <div
      id="sale-details-modal"
      class="fixed inset-0 modal-overlay hidden flex items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-xl shadow-lg p-6 w-full max-w-2xl animate-fadeIn"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">
            <i class="fas fa-receipt mr-2 text-primary"></i>
            <span>Sotuv Tafsilotlari</span>
          </h3>
          <button
            id="close-sale-details-modal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div id="sale-details-content" class="space-y-4">
          <!-- JavaScript tomonidan to'ldiriladi -->
        </div>

        <div class="flex justify-end mt-6">
          <button
            id="print-sale"
            class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center mr-3"
          >
            <i class="fas fa-print mr-2"></i>Chop etish
          </button>
          <button
            id="close-sale-details"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center"
          >
            <i class="fas fa-times mr-2"></i>Yopish
          </button>
        </div>
      </div>
    </div>

    <!-- Qarzdorlik To'lash Modali -->
    <div
      id="pay-debt-modal"
      class="fixed inset-0 modal-overlay hidden flex items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md animate-fadeIn"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">
            <i class="fas fa-money-bill-wave mr-2 text-success"></i>
            <span>Qarzdorlikni To'lash</span>
          </h3>
          <button
            id="close-pay-debt-modal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="space-y-4">
          <input type="hidden" id="pay-debt-id" value="" />
          <p class="text-gray-700">
            Qarzdor: <span id="pay-debt-name" class="font-medium"></span>
          </p>
          <p class="text-gray-700">
            Umumiy qarz:
            <span id="pay-debt-amount" class="font-medium text-danger"></span>
          </p>

          <div class="relative">
            <i
              class="fas fa-money-bill-wave absolute left-3 top-3 text-gray-400"
            ></i>
            <input
              type="number"
              id="pay-debt-payment"
              placeholder="To'lov miqdori"
              class="w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
        </div>

        <div class="flex space-x-3 mt-6">
          <button
            id="complete-debt-payment"
            class="bg-success hover:bg-success/90 text-white px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-check mr-2"></i>To'lash
          </button>
          <button
            id="cancel-debt-payment"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium transition-all flex-1 flex items-center justify-center"
          >
            <i class="fas fa-times mr-2"></i>Bekor Qilish
          </button>
        </div>
      </div>
    </div>

    <!-- Bildirishnoma -->
    <div
      id="notification-container"
      class="fixed top-4 right-4 z-50 space-y-4"
    ></div>

    <script>
      // Real-time clock function
      function updateClock() {
        const now = new Date();
        const options = {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        };
        const timeString = now.toLocaleString('uz-UZ', options);
        
        // Update all clock displays
        const clockElements = [
          document.getElementById('current-time'),
          document.getElementById('mobile-current-time'),
          document.getElementById('header-current-time')
        ];
        
        clockElements.forEach(element => {
          if (element) {
            element.textContent = timeString;
          }
        });
      }

      // Update clock every second
      setInterval(updateClock, 1000);
      updateClock(); // Initial call

      // Ma'lumotlar bazasi - sneklar qo'shildi
      const defaultProducts = [ 
      {
          id: 1,
          name: "Non",
          price: 5000,
          stock: 100,
          unit: "sanoq",
          type: "food",
        },
        {
          id: 2,
          name: "Sut",
          price: 12000,
          stock: 50,
          unit: "sanoq",
          type: "food",
        },
        {
          id: 3,
          name: "Yog'",
          price: 8000,
          stock: 75,
          unit: "kg",
          type: "food",
        },
        {
          id: 4,
          name: "Pepsi",
          price: 10000,
          stock: 30,
          unit: "sanoq",
          type: "drink",
          volume: "1.5",
        },
        {
          id: 5,
          name: "Lays Original",
          price: 8000,
          stock: 50,
          unit: "sanoq",
          type: "snacks",
          weight: "150",
        },
        {
          id: 6,
          name: "Lays Cheese",
          price: 12000,
          stock: 40,
          unit: "sanoq",
          type: "snacks",
          weight: "300",
        },
        {
          id: 7,
          name: "Pringles Original",
          price: 25000,
          stock: 25,
          unit: "sanoq",
          type: "snacks",
          weight: "500",
        },
        {
  id: 8,
  name: "Shakar",
  price: 10000,
  stock: 80,
  unit: "kg",
  type: "Oziq-ovqat",
},
{
  id: 13,
  name: "Cola",
  price: 10000,
  stock: 60,
  unit: "sanoq",
  type: "Ichimlik",
  volume: "1.5",
},
{
  id: 15,
  name: "Konfet (500gr)",
  price: 13000,
  stock: 50,
  unit: "sanoq",
  type: "Shirinlik",
  weight: "500",
},
{
  id: 16,
  name: "Piyoz",
  price: 3500,
  stock: 90,
  unit: "kg",
  type: "Sabzavot",
},
{
  id: 17,
  name: "Non",
  price: 14643,
  stock: 46,
  unit: "sanoq",
  type: "Oziq-ovqat"
},
{
  id: 18,
  name: "Non (2)",
  price: 30736,
  stock: 97,
  unit: "kg",
  type: "Oziq-ovqat"
},
{
  id: 19,
  name: "Sut",
  price: 43627,
  stock: 38,
  unit: "sanoq",
  type: "Oziq-ovqat"
},
{
  id: 20,
  name: "Shakar",
  price: 27426,
  stock: 73,
  unit: "kg",
  type: "Oziq-ovqat"
},
{
  id: 21,
  name: "Tuz",
  price: 15445,
  stock: 91,
  unit: "sanoq",
  type: "Oziq-ovqat"
}

       ];
       let products = [];

firebase.database().ref("products").once("value").then((snapshot) => {
  const data = snapshot.val();
  if (data) {
    products = Object.values(data);
  } else {
    products = defaultProducts;
    firebase.database().ref("products").set(
      Object.fromEntries(defaultProducts.map((p) => [p.id, p]))
    );
  }

  renderProducts();
  renderStock();
});

      let cart = [];
      let salesHistory = JSON.parse(localStorage.getItem("salesHistory")) || [];
      let debtors = JSON.parse(localStorage.getItem("debtors")) || [];

      // Elementlarni tanlash
      const sections = {
        home: document.getElementById("home"),
        kassa: document.getElementById("kassa"),
        ombor: document.getElementById("ombor"),
        hisobotlar: document.getElementById("hisobotlar"),
        qarzdorlar: document.getElementById("qarzdorlar"),
      };
      const pageTitle = document.getElementById("page-title");
      const productsList = document.getElementById("products-list");
      const cartItems = document.getElementById("cart-items");
      const cartTotal = document.getElementById("cart-total");
      const payCashBtn = document.getElementById("pay-cash");
      const payDebtBtn = document.getElementById("pay-debt");
      const debtForm = document.getElementById("debt-form");
      const debtorFirstname = document.getElementById("debtor-firstname");
      const debtorLastname = document.getElementById("debtor-lastname");
      const debtorPhone = document.getElementById("debtor-phone");
      const debtAmount = document.getElementById("debt-amount");
      const completeDebtSaleBtn = document.getElementById("complete-debt-sale");
      const searchInput = document.getElementById("search");
      const stockSearchInput = document.getElementById("stock-search");
      const debtorsSearchInput = document.getElementById("debtors-search");
      const stockTable = document.getElementById("stock-table");
      const totalSales = document.getElementById("total-sales");
      const totalItems = document.getElementById("total-items");
      const totalDebt = document.getElementById("total-debt");
      const salesHistoryTable = document.getElementById("sales-history");
      const debtorsTable = document.getElementById("debtors-table");
      const productModal = document.getElementById("product-modal");
      const updateStockModal = document.getElementById("update-stock-modal");
      const saleDetailsModal = document.getElementById("sale-details-modal");
      const payDebtModal = document.getElementById("pay-debt-modal");
      const openProductModalBtn = document.getElementById("open-product-modal");
      const closeProductModalBtn = document.getElementById(
        "close-product-modal"
      );
      const closeUpdateStockModalBtn = document.getElementById(
        "close-update-stock-modal"
      );
      const closeSaleDetailsModalBtn = document.getElementById(
        "close-sale-details-modal"
      );
      const closePayDebtModalBtn = document.getElementById(
        "close-pay-debt-modal"
      );
      const saveProductBtn = document.getElementById("save-product");
      // Saqlash tugmasi bosilganda mahsulotni Firebase'ga yozish
saveProductBtn.addEventListener("click", function () {
  const newProductId = Date.now(); // noyob ID

  const newProduct = {
    id: newProductId,
    name: modalProductName.value,
    price: parseFloat(modalProductPrice.value),
    stock: parseFloat(modalProductQuantity.value),
    type: modalProductType.value,
    unit: unitKg.checked ? "kg" : "sanoq",
  };

  // Hajm va ogâ€˜irlik turlari uchun
  if (newProduct.type === "drink") {
    newProduct.volume = modalProductVolume.value;
  }
  if (newProduct.type === "snacks") {
    newProduct.weight = modalProductWeight.value;
  }

  // Firebase'ga yozish
  firebase.database().ref("products/" + newProductId).set(newProduct, function (error) {
    if (error) {
      alert("Xatolik yuz berdi: " + error.message);
    } else {
      showNotification("Mahsulot muvaffaqiyatli saqlandi âœ…");
    }
  });

  // Forma tozalash
  modalProductName.value = "";
  modalProductPrice.value = "";
  modalProductQuantity.value = "";
  modalProductType.value = "other";
  modalProductVolume.value = "";
  modalProductWeight.value = "";
  unitKg.checked = false;
  unitSanoq.checked = false;

  // Modalni yopish
  productModal.classList.add("hidden");
});

      const cancelProductBtn = document.getElementById("cancel-product");
      const saveStockUpdateBtn = document.getElementById("save-stock-update");
      const cancelStockUpdateBtn = document.getElementById(
        "cancel-stock-update"
      );
      const closeSaleDetailsBtn = document.getElementById("close-sale-details");
      const printSaleBtn = document.getElementById("print-sale");
      const completeDebtPaymentBtn = document.getElementById(
        "complete-debt-payment"
      );
      const cancelDebtPaymentBtn = document.getElementById(
        "cancel-debt-payment"
      );
      const modalProductName = document.getElementById("modal-product-name");
      const modalProductQuantity = document.getElementById(
        "modal-product-quantity"
      );
      const modalProductPrice = document.getElementById("modal-product-price");
      const modalProductType = document.getElementById("modal-product-type");
      const modalProductVolume = document.getElementById(
        "modal-product-volume"
      );
      const modalProductWeight = document.getElementById("modal-product-weight");
      const volumeContainer = document.getElementById("volume-container");
      const weightContainer = document.getElementById("weight-container");
      const editProductId = document.getElementById("edit-product-id");
      const modalTitle = document.getElementById("modal-title");
      const unitKg = document.getElementById("unit-kg");
      const unitSanoq = document.getElementById("unit-sanoq");
      const updateProductId = document.getElementById("update-product-id");
      const updateProductName = document.getElementById("update-product-name");
      const updateCurrentStock = document.getElementById(
        "update-current-stock"
      );
      const updateStockQuantity = document.getElementById(
        "update-stock-quantity"
      );
      const saleDetailsContent = document.getElementById(
        "sale-details-content"
      );
      const payDebtId = document.getElementById("pay-debt-id");
      const payDebtName = document.getElementById("pay-debt-name");
      const payDebtAmount = document.getElementById("pay-debt-amount");
      const payDebtPayment = document.getElementById("pay-debt-payment");
      const salesDateFilter = document.getElementById("sales-date-filter");
      const paymentTypeFilter = document.getElementById("payment-type-filter");
      const todaySales = document.getElementById("today-sales");
      const salesIncrease = document.getElementById("sales-increase");
      const productsCount = document.getElementById("products-count");
      const lowStockCount = document.getElementById("low-stock-count");
      const debtorsCount = document.getElementById("debtors-count");
      const totalDebtAmount = document.getElementById("total-debt-amount");
      const monthlyIncome = document.getElementById("monthly-income");
      const incomeIncrease = document.getElementById("income-increase");
      const recentSales = document.getElementById("recent-sales");
      const lowStockProducts = document.getElementById("low-stock-products");
      const mobileSidebar = document.getElementById("mobile-sidebar");
      const sidebarOverlay = document.getElementById("sidebar-overlay");

      // Mahsulot turi o'zgartirilganda hajm/og'irlik maydonini ko'rsatish/yashirish
      if (modalProductType) {
        modalProductType.addEventListener("change", function () {
          if (this.value === "drink") {
            volumeContainer.classList.remove("hidden");
            weightContainer.classList.add("hidden");
          } else if (this.value === "snacks") {
            weightContainer.classList.remove("hidden");
            volumeContainer.classList.add("hidden");
          } else {
            volumeContainer.classList.add("hidden");
            weightContainer.classList.add("hidden");
          }
        });
      }

      // Bo'limlarni ko'rsatish/yashirish
      function showSection(sectionId) {
  // Barcha sectionlarni yashirish
  Object.values(sections).forEach((section) =>
    section.classList.add("hidden")
  );
  sections[sectionId].classList.remove("hidden");

  // URLga #section qoâ€˜shish
  history.pushState({ section: sectionId }, "", `#${sectionId}`);

  // Sidebar active class
  document.querySelectorAll(".sidebar-item").forEach((item) => {
    item.classList.remove("active");
  });
  document.querySelectorAll(`.sidebar-item`).forEach((item) => {
    if (item.getAttribute("onclick").includes(`'${sectionId}'`)) {
      item.classList.add("active");
    }
  });

  // Sarlavha yangilash
  switch (sectionId) {
    case "home":
      pageTitle.textContent = "Bosh Sahifa";
      break;
    case "kassa":
      pageTitle.textContent = "Kassa";
      break;
    case "ombor":
      pageTitle.textContent = "Ombor Boshqaruvi";
      break;
    case "hisobotlar":
      pageTitle.textContent = "Hisobotlar";
      break;
    case "qarzdorlar":
      pageTitle.textContent = "Qarzdorlar";
      break;
  }
}

      // Mobile sidebar toggle
      function toggleMobileSidebar() {
        const isOpen = mobileSidebar.classList.contains("translate-x-0");

        if (isOpen) {
          mobileSidebar.classList.remove("translate-x-0");
          mobileSidebar.classList.add("-translate-x-full");
          sidebarOverlay.classList.add("hidden");
        } else {
          mobileSidebar.classList.remove("-translate-x-full");
          mobileSidebar.classList.add("translate-x-0");
          sidebarOverlay.classList.remove("hidden");
        }
      }

      // Mahsulot turini o'zbekcha ko'rsatish
      function getProductTypeText(type) {
        switch (type) {
          case "drink":
            return "Ichimlik";
          case "food":
            return "Oziq-ovqat";
          case "fruit":
            return "Meva";
          case "sweets":
            return "Shirinlik";
          case "snacks":
            return "Sneklar";
          case "vegetable":
            return "Sabzavot";
          default:
            return "Boshqa";
        }
      }

      // Mahsulotlarni ko'rsatish
      function renderProducts(filter = "") {
        productsList.innerHTML = "";
        products
          .filter((p) => p.name.toLowerCase().includes(filter.toLowerCase()))
          .forEach((product) => {
            const div = document.createElement("div");
            div.className =
              "bg-white border border-gray-200 rounded-lg shadow-sm hover-scale overflow-hidden";

            const stockStatus =
              product.stock <= 15
                ? `<span class="text-xs font-medium text-white bg-danger px-2 py-1 rounded-full">Kam qoldiq</span>`
                : `<span class="text-xs font-medium text-white bg-success px-2 py-1 rounded-full">Mavjud</span>`;

            // Mahsulot turi, hajmi va og'irligi
            let productDetails = `<p class="text-gray-600 flex items-center">
                  <i class="fas fa-tag w-5 text-primary"></i>
                  <span>${getProductTypeText(product.type)}</span>
                </p>`;

            if (product.type === "drink" && product.volume) {
              productDetails += `<p class="text-gray-600 flex items-center">
                  <i class="fas fa-flask w-5 text-primary"></i>
                  <span>Hajmi: ${product.volume}L</span>
                </p>`;
            }

            if (product.type === "snacks" && product.weight) {
              productDetails += `<p class="text-gray-600 flex items-center">
                  <i class="fas fa-weight w-5 text-primary"></i>
                  <span>Og'irligi: ${product.weight}gr</span>
                </p>`;
            }

            div.innerHTML = `
            <div class="p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-medium text-gray-800">${
                  product.name
                }</h3>
                ${stockStatus}
              </div>
              <div class="space-y-1 mb-4">
                ${productDetails}
                <p class="text-gray-600 flex items-center">
                  <i class="fas fa-tag w-5 text-primary"></i>
                  <span>${product.price.toLocaleString()} UZS/${
              product.unit
            }</span>
                </p>
                <p class="text-gray-600 flex items-center">
                  <i class="fas fa-box w-5 text-primary"></i>
                  <span>Omborda: ${product.stock} ${product.unit}</span>
                </p>
              </div>
              <div class="flex items-center">
                <div class="flex-1">
                  <div class="relative">
                   <input 
                   type="number" 
                   min="0.1" 
                   step="0.1"
                   max="${product.stock}" 
                   value="1" 
                   id="qty-${product.id}" 
                   class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                   ${product.stock <= 0 ? "disabled" : ""}
                />
                  </div>
                </div>
                <button
                  class="ml-2 ${
                    product.stock <= 0
                      ? "bg-gray-400 cursor-not-allowed"
                      : "bg-primary hover:bg-primary/90"
                  } text-white px-4 py-2 rounded-lg font-medium transition-all"
                  onclick="addToCart(${product.id})"
                  ${product.stock <= 0 ? "disabled" : ""}
                >
                  <i class="fas fa-cart-plus"></i>
                </button>
              </div>
            </div>
          `;
            productsList.appendChild(div);
          });
      }

      // Savatni ko'rsatish
      function renderCart() {
        cartItems.innerHTML = "";

        if (cart.length === 0) {
          cartItems.innerHTML = `
          <div class="flex flex-col items-center justify-center py-6">
            <i class="fas fa-shopping-cart text-4xl text-gray-300 mb-2"></i>
            <p class="text-gray-500">Savat bo'sh</p>
          </div>
        `;
          return;
        }

        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        cart.forEach((item, index) => {
          const div = document.createElement("div");
          div.className =
            "flex justify-between items-center border-b border-gray-200 py-3";

          // Mahsulot turi, hajmi va og'irligi
          let itemDetails = item.name;
          if (item.type === "drink" && item.volume) {
            itemDetails += ` (${item.volume}L)`;
          }
          if (item.type === "snacks" && item.weight) {
            itemDetails += ` (${item.weight}gr)`;
          }

          div.innerHTML = `
          <div>
            <h4 class="font-medium text-gray-800">${itemDetails}</h4>
            <p class="text-sm text-gray-600">${item.price.toLocaleString()} UZS x ${
            item.quantity
          } ${item.unit}</p>
          </div>
          <div class="flex items-center">
            <span class="font-medium text-primary mr-3">${(
              item.price * item.quantity
            ).toLocaleString()} UZS</span>
            <button onclick="removeFromCart(${index})" class="text-danger hover:text-danger/80">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
          cartItems.appendChild(div);
        });

        cartTotal.textContent = `${total.toLocaleString()} UZS`;
        debtAmount.textContent = `${total.toLocaleString()}`;
      }

      // Omborni ko'rsatish
      function renderStock(filter = "") {
        stockTable.innerHTML = "";

        // Mahsulotlarni qoldiq bo'yicha saralash (kam qoldiqlilar yuqorida)
        const sortedProducts = [...products]
          .filter((p) => p.name.toLowerCase().includes(filter.toLowerCase()))
          .sort((a, b) => a.stock - b.stock);

        sortedProducts.forEach((product) => {
          const tr = document.createElement("tr");

          // Qoldiq 15 dan kam bo'lsa xavfli deb belgilash
          const stockStatus =
            product.stock <= 15
              ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger text-white">Kam</span>`
              : `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success text-white">Yetarli</span>`;

          // Mahsulot turi, hajmi va og'irligi
          let productName = product.name;
          if (product.type === "drink" && product.volume) {
            productName += ` (${product.volume}L)`;
          }
          if (product.type === "snacks" && product.weight) {
            productName += ` (${product.weight}gr)`;
          }

          tr.innerHTML = `
      <td class="px-4 py-3 whitespace-nowrap">#${product.id}</td>
      <td class="px-4 py-3 whitespace-nowrap font-medium text-gray-800">${productName}</td>
      <td class="px-4 py-3 whitespace-nowrap">${getProductTypeText(
        product.type
      )}</td>
      <td class="px-4 py-3 whitespace-nowrap">${product.price.toLocaleString()} UZS</td>
      <td class="px-4 py-3 whitespace-nowrap">
        ${product.stock} ${product.unit} ${stockStatus}
      </td>
      <td class="px-4 py-3 whitespace-nowrap">${product.unit}</td>
      <td class="px-4 py-3 whitespace-nowrap">
        <div class="flex space-x-2">
          <button onclick="openUpdateStockModal(${
            product.id
          })" class="text-primary hover:text-primary/80">
            <i class="fas fa-sync"></i>
          </button>
          <button onclick="openEditProductModal(${
            product.id
          })" class="text-info hover:text-info/80">
            <i class="fas fa-edit"></i>
          </button>
          <button onclick="deleteProduct(${
            product.id
          })" class="text-danger hover:text-danger/80">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </td>
    `;
          stockTable.appendChild(tr);
        });
      }

      // Hisobotlarni ko'rsatish
      function renderReports(dateFilter = "", paymentFilter = "all") {
        const total = salesHistory.reduce((sum, sale) => sum + sale.total, 0);
        const totalItemsSold = salesHistory.reduce(
          (sum, sale) =>
            sum + sale.items.reduce((acc, item) => acc + item.quantity, 0),
          0
        );
        const totalDebtAmount = debtors.reduce(
          (sum, debtor) => sum + debtor.amount,
          0
        );

        totalSales.textContent = `${total.toLocaleString()} UZS`;
        totalItems.textContent = totalItemsSold;
        totalDebt.textContent = `${totalDebtAmount.toLocaleString()} UZS`;

        salesHistoryTable.innerHTML = "";

        let filteredSales = [...salesHistory];

        // Sana bo'yicha filtrlash
        if (dateFilter) {
          const filterDate = new Date(dateFilter);
          filteredSales = filteredSales.filter((sale) => {
            const saleDate = new Date(sale.date);
            return saleDate.toDateString() === filterDate.toDateString();
          });
        }

        // To'lov turi bo'yicha filtrlash
        if (paymentFilter !== "all") {
          filteredSales = filteredSales.filter(
            (sale) => sale.paymentMethod === paymentFilter
          );
        }

        if (filteredSales.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td colspan="6" class="px-4 py-4 text-center text-gray-500">
            Ma'lumotlar topilmadi
          </td>
        `;
          salesHistoryTable.appendChild(tr);
          return;
        }

        filteredSales.forEach((sale) => {
          const tr = document.createElement("tr");
          const itemsCount = sale.items.reduce(
            (acc, item) => acc + item.quantity,
            0
          );

          tr.innerHTML = `
          <td class="px-4 py-3 whitespace-nowrap">#${sale.id}</td>
          <td class="px-4 py-3 whitespace-nowrap">${formatDateTime(sale.date)}</td>
          <td class="px-4 py-3 whitespace-nowrap">${itemsCount} ta mahsulot</td>
          <td class="px-4 py-3 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
              sale.paymentMethod === "Naqd" ? "bg-success" : "bg-warning"
            } text-white">
              ${sale.paymentMethod}
            </span>
          </td>
          <td class="px-4 py-3 whitespace-nowrap font-medium">${sale.total.toLocaleString()} UZS</td>
          <td class="px-4 py-3 whitespace-nowrap">
            <button onclick="openSaleDetailsModal(${
              sale.id
            })" class="text-primary hover:text-primary/80">
              <i class="fas fa-eye"></i>
            </button>
          </td>
        `;
          salesHistoryTable.appendChild(tr);
        });
      }

      // Qarzdorlarni ko'rsatish
      function renderDebtors(filter = "") {
        debtorsTable.innerHTML = "";

        const filteredDebtors = debtors.filter(
          (d) =>
            `${d.firstname} ${d.lastname}`
              .toLowerCase()
              .includes(filter.toLowerCase()) || d.phone.includes(filter)
        );

        if (filteredDebtors.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td colspan="6" class="px-4 py-4 text-center text-gray-500">
            ${filter ? "Qarzdor topilmadi" : "Hozircha qarzdorlar yo'q"}
          </td>
        `;
          debtorsTable.appendChild(tr);
          return;
        }

        filteredDebtors.forEach((debtor) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td class="px-4 py-3 whitespace-nowrap">#${debtor.id}</td>
          <td class="px-4 py-3 whitespace-nowrap font-medium text-gray-800">${
            debtor.firstname
          } ${debtor.lastname}</td>
          <td class="px-4 py-3 whitespace-nowrap">${debtor.phone}</td>
          <td class="px-4 py-3 whitespace-nowrap font-medium text-danger">${debtor.amount.toLocaleString()} UZS</td>
          <td class="px-4 py-3 whitespace-nowrap">${formatDateTime(
            debtor.date
          )}</td>
          <td class="px-4 py-3 whitespace-nowrap">
            <div class="flex space-x-2">
              <button onclick="openPayDebtModal(${
                debtor.id
              })" class="text-success hover:text-success/80">
                <i class="fas fa-money-bill-wave"></i>
              </button>
              <button onclick="deleteDebtor(${
                debtor.id
              })" class="text-danger hover:text-danger/80">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
          debtorsTable.appendChild(tr);
        });
      }

      // Bosh sahifani yangilash
      function updateDashboard() {
        // Bugungi sotuvlar
        const today = new Date().toDateString();
        const todaySalesData = salesHistory.filter(
          (sale) => new Date(sale.date).toDateString() === today
        );
        const todaySalesTotal = todaySalesData.reduce(
          (sum, sale) => sum + sale.total,
          0
        );
        todaySales.textContent = todaySalesTotal.toLocaleString();

        // O'tgan kunga nisbatan o'sish
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdaySalesData = salesHistory.filter(
          (sale) =>
            new Date(sale.date).toDateString() === yesterday.toDateString()
        );
        const yesterdaySalesTotal = yesterdaySalesData.reduce(
          (sum, sale) => sum + sale.total,
          0
        );

        let increase = 0;
        if (yesterdaySalesTotal > 0) {
          increase =
            ((todaySalesTotal - yesterdaySalesTotal) / yesterdaySalesTotal) *
            100;
        }
        salesIncrease.textContent = `${Math.round(increase)}%`;

        // Mahsulotlar soni
        productsCount.textContent = products.length;

        // Kam qoldiq mahsulotlar
        const lowStockProductsData = products.filter((p) => p.stock <= 15);
        lowStockCount.textContent = lowStockProductsData.length;

        // Qarzdorlar
        debtorsCount.textContent = debtors.length;
        const totalDebtAmountValue = debtors.reduce(
          (sum, debtor) => sum + debtor.amount,
          0
        );
        totalDebtAmount.textContent = totalDebtAmountValue.toLocaleString();

        // Oylik daromad
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        const thisMonthSales = salesHistory.filter((sale) => {
          const saleDate = new Date(sale.date);
          return (
            saleDate.getMonth() === currentMonth &&
            saleDate.getFullYear() === currentYear
          );
        });
        const thisMonthTotal = thisMonthSales.reduce(
          (sum, sale) => sum + sale.total,
          0
        );
        monthlyIncome.textContent = thisMonthTotal.toLocaleString();

        // O'tgan oyga nisbatan o'sish
        const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
        const lastMonthYear =
          currentMonth === 0 ? currentYear - 1 : currentYear;
        const lastMonthSales = salesHistory.filter((sale) => {
          const saleDate = new Date(sale.date);
          return (
            saleDate.getMonth() === lastMonth &&
            saleDate.getFullYear() === lastMonthYear
          );
        });
        const lastMonthTotal = lastMonthSales.reduce(
          (sum, sale) => sum + sale.total,
          0
        );

        let monthIncrease = 0;
        if (lastMonthTotal > 0) {
          monthIncrease =
            ((thisMonthTotal - lastMonthTotal) / lastMonthTotal) * 100;
        }
        incomeIncrease.textContent = `${Math.round(monthIncrease)}%`;

        // So'nggi sotuvlar
        recentSales.innerHTML = "";
        const recentSalesData = [...salesHistory]
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .slice(0, 5);

        if (recentSalesData.length === 0) {
          const tr = document.createElement("tr");
          tr.innerHTML = `
          <td colspan="5" class="px-4 py-4 text-center text-gray-500">
            Hozircha sotuvlar yo'q
          </td>
        `;
          recentSales.appendChild(tr);
        } else {
          recentSalesData.forEach((sale) => {
            const tr = document.createElement("tr");
            const itemsCount = sale.items.reduce(
              (acc, item) => acc + item.quantity,
              0
            );

            tr.innerHTML = `
            <td class="px-4 py-3 whitespace-nowrap">#${sale.id}</td>
            <td class="px-4 py-3 whitespace-nowrap">${formatDateTime(
              sale.date
            )}</td>
            <td class="px-4 py-3 whitespace-nowrap">${itemsCount} ta mahsulot</td>
            <td class="px-4 py-3 whitespace-nowrap">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                sale.paymentMethod === "Naqd" ? "bg-success" : "bg-warning"
              } text-white">
                ${sale.paymentMethod}
              </span>
            </td>
            <td class="px-4 py-3 whitespace-nowrap font-medium">${sale.total.toLocaleString()} UZS</td>
          `;
            recentSales.appendChild(tr);
          });
        }

        // Kam qoldiq mahsulotlar
        lowStockProducts.innerHTML = "";

        if (lowStockProductsData.length === 0) {
          lowStockProducts.innerHTML = `
          <div class="text-center py-4 text-gray-500">
            Kam qoldiq mahsulotlar yo'q
          </div>
        `;
        } else {
          // Qoldiq bo'yicha saralash
          [...lowStockProductsData]
            .sort((a, b) => a.stock - b.stock)
            .forEach((product) => {
              const div = document.createElement("div");
              div.className =
                "flex justify-between items-center p-3 border border-gray-200 rounded-lg";

              // Mahsulot turi, hajmi va og'irligi
              let productName = product.name;
              if (product.type === "drink" && product.volume) {
                productName += ` (${product.volume}L)`;
              }
              if (product.type === "snacks" && product.weight) {
                productName += ` (${product.weight}gr)`;
              }

              div.innerHTML = `
              <div>
                <h4 class="font-medium text-gray-800">${productName}</h4>
                <p class="text-sm text-gray-600">${product.price.toLocaleString()} UZS/${
                product.unit
              }</p>
              </div>
              <div class="text-right">
                <p class="text-danger font-medium">${product.stock} ${
                product.unit
              }</p>
                <button onclick="openUpdateStockModal(${
                  product.id
                })" class="text-xs text-primary hover:underline">
                  Yangilash
                </button>
              </div>
            `;
              lowStockProducts.appendChild(div);
            });
        }
      }

      // Savatga qo'shish
      function addToCart(productId) {
        const product = products.find((p) => p.id === productId);
        const quantityInput = document.getElementById(`qty-${productId}`);
        const quantity = parseFloat(quantityInput.value) || 1;


        if (quantity <= 0) {
          showNotification("Iltimos, to'g'ri miqdor kiriting!", "warning");
          return;
        }

        if (product.stock < quantity) {
          showNotification(
            `Omborda faqat ${product.stock} ${product.unit} qolgan!`,
            "warning"
          );
          return;
        }

        const existingItemIndex = cart.findIndex(
          (item) => item.id === productId
        );

        if (existingItemIndex !== -1) {
          cart[existingItemIndex].quantity += quantity;
        } else {
          cart.push({ ...product, quantity });
        }

        product.stock -= quantity;
        quantityInput.value = 1;
        quantityInput.max = product.stock;

        if (product.stock <= 0) {
          quantityInput.disabled = true;
          quantityInput.parentElement.parentElement.nextElementSibling.classList.remove(
            "bg-primary",
            "hover:bg-primary/90"
          );
          quantityInput.parentElement.parentElement.nextElementSibling.classList.add(
            "bg-gray-400",
            "cursor-not-allowed"
          );
          quantityInput.parentElement.parentElement.nextElementSibling.disabled = true;
        }

        saveData();
        renderCart();
        renderProducts(searchInput.value);
        showNotification(
          `${quantity} ${product.unit} ${product.name} savatga qo'shildi`,
          "success"
        );
      }

      // Savatdan o'chirish
      function removeFromCart(index) {
        const item = cart[index];
        const product = products.find((p) => p.id === item.id);

        product.stock += item.quantity;
        cart.splice(index, 1);

        saveData();
        renderCart();
        renderProducts(searchInput.value);
        showNotification(`${item.name} savatdan olib tashlandi`, "info");
      }

      // Mahsulot qo'shish modali
      function openProductModal() {
        editProductId.value = "";
        modalTitle.textContent = "Yangi Mahsulot Qo'shish";
        modalProductName.value = "";
        modalProductQuantity.value = "";
        modalProductPrice.value = "";
        modalProductType.value = "other";
        volumeContainer.classList.add("hidden");
        weightContainer.classList.add("hidden");
        unitKg.checked = true;
        productModal.classList.remove("hidden");
      }

      // Mahsulotni tahrirlash modali
      function openEditProductModal(productId) {
        const product = products.find((p) => p.id === productId);
        if (!product) return;

        editProductId.value = productId;
        modalTitle.textContent = "Mahsulotni Tahrirlash";
        modalProductName.value = product.name;
        modalProductQuantity.value = product.stock;
        modalProductPrice.value = product.price;
        modalProductType.value = product.type || "other";

        if (product.type === "drink") {
          volumeContainer.classList.remove("hidden");
          weightContainer.classList.add("hidden");
          modalProductVolume.value = product.volume || "1";
        } else if (product.type === "snacks") {
          weightContainer.classList.remove("hidden");
          volumeContainer.classList.add("hidden");
          modalProductWeight.value = product.weight || "150";
        } else {
          volumeContainer.classList.add("hidden");
          weightContainer.classList.add("hidden");
        }

        if (product.unit === "kg") {
          unitKg.checked = true;
        } else {
          unitSanoq.checked = true;
        }

        productModal.classList.remove("hidden");
      }

      // Mahsulot qoldiqini yangilash modali
      function openUpdateStockModal(productId) {
        const product = products.find((p) => p.id === productId);
        if (!product) return;

        updateProductId.value = productId;
        updateProductName.textContent = product.name;
        updateCurrentStock.textContent = `${product.stock} ${product.unit}`;
        updateStockQuantity.value = product.stock;
        updateStockQuantity.step = product.unit === "kg" ? "0.1" : "1";

        updateStockModal.classList.remove("hidden");
      }

      // Sotuv tafsilotlari modali
      function openSaleDetailsModal(saleId) {
        const sale = salesHistory.find((s) => s.id === saleId);
        if (!sale) return;

        saleDetailsContent.innerHTML = `
        <div class="bg-gray-50 p-4 rounded-lg mb-4">
          <div class="flex justify-between mb-2">
            <span class="text-gray-600">Sotuv ID:</span>
            <span class="font-medium">#${sale.id}</span>
          </div>
          <div class="flex justify-between mb-2">
            <span class="text-gray-600">Sana/Vaqt:</span>
            <span class="font-medium">${formatDateTime(sale.date)}</span>
          </div>
          <div class="flex justify-between mb-2">
            <span class="text-gray-600">To'lov turi:</span>
            <span class="font-medium ${
              sale.paymentMethod === "Naqd" ? "text-success" : "text-warning"
            }">${sale.paymentMethod}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Jami summa:</span>
            <span class="font-medium text-primary">${sale.total.toLocaleString()} UZS</span>
          </div>
        </div>
        
        <h4 class="font-medium text-gray-800 mb-3">Mahsulotlar ro'yxati:</h4>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mahsulot</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Turi</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Narxi</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Miqdor</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jami</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              ${sale.items
                .map((item) => {
                  // Mahsulot turi, hajmi va og'irligi
                  let productName = item.name;
                  if (item.type === "drink" && item.volume) {
                    productName += ` (${item.volume}L)`;
                  }
                  if (item.type === "snacks" && item.weight) {
                    productName += ` (${item.weight}gr)`;
                  }

                  return `
                    <tr>
                      <td class="px-4 py-2 whitespace-nowrap font-medium text-gray-800">${productName}</td>
                      <td class="px-4 py-2 whitespace-nowrap">${getProductTypeText(
                        item.type || "other"
                      )}</td>
                      <td class="px-4 py-2 whitespace-nowrap">${item.price.toLocaleString()} UZS</td>
                      <td class="px-4 py-2 whitespace-nowrap">${
                        item.quantity
                      } ${item.unit}</td>
                      <td class="px-4 py-2 whitespace-nowrap font-medium">${(
                        item.price * item.quantity
                      ).toLocaleString()} UZS</td>
                    </tr>
                  `;
                })
                .join("")}
            </tbody>
          </table>
        </div>
      `;

        saleDetailsModal.classList.remove("hidden");
      }

      // Qarzdorlik to'lash modali
      function openPayDebtModal(debtorId) {
        const debtor = debtors.find((d) => d.id === debtorId);
        if (!debtor) return;

        payDebtId.value = debtorId;
        payDebtName.textContent = `${debtor.firstname} ${debtor.lastname}`;
        payDebtAmount.textContent = `${debtor.amount.toLocaleString()} UZS`;
        payDebtPayment.value = debtor.amount;
        payDebtPayment.max = debtor.amount;

        payDebtModal.classList.remove("hidden");
      }

      // Mahsulotni saqlash
      function saveProduct() {
        const id = editProductId.value ? parseInt(editProductId.value) : null;
        const name = modalProductName.value.trim();
        const quantity = parseFloat(modalProductQuantity.value);
        const price = parseInt(modalProductPrice.value);
        const unit = unitKg.checked ? "kg" : "sanoq";
        const type = modalProductType.value;
        let volume = null;
        let weight = null;

        if (type === "drink") {
          volume = modalProductVolume.value;
        } else if (type === "snacks") {
          weight = modalProductWeight.value;
        }

        if (
          !name ||
          isNaN(quantity) ||
          isNaN(price) ||
          quantity < 0 ||
          price <= 0
        ) {
          showNotification(
            "Iltimos, barcha maydonlarni to'g'ri to'ldiring!",
            "danger"
          );
          return;
        }

        if (id) {
          // Tahrirlash
          const productIndex = products.findIndex((p) => p.id === id);
          if (productIndex !== -1) {
            products[productIndex] = {
              ...products[productIndex],
              name,
              price,
              stock: quantity,
              unit,
              type,
              volume: type === "drink" ? volume : null,
              weight: type === "snacks" ? weight : null,
            };
            showNotification("Mahsulot muvaffaqiyatli yangilandi!", "success");
          }
        } else {
          // Yangi qo'shish
          products.push({
            id: products.length
              ? Math.max(...products.map((p) => p.id)) + 1
              : 1,
            name,
            price,
            stock: quantity,
            unit,
            type,
            volume: type === "drink" ? volume : null,
            weight: type === "snacks" ? weight : null,
          });
          showNotification("Mahsulot muvaffaqiyatli qo'shildi!", "success");
        }

        saveData();
        productModal.classList.add("hidden");
        renderProducts(searchInput.value);
        renderStock(stockSearchInput.value);
        updateDashboard();
      }

      // Mahsulot qoldiqini yangilash
      function updateStock() {
        const id = parseInt(updateProductId.value);
        const quantity = parseFloat(updateStockQuantity.value);

        if (isNaN(quantity) || quantity < 0) {
          showNotification("Iltimos, to'g'ri miqdor kiriting!", "danger");
          return;
        }

        const productIndex = products.findIndex((p) => p.id === id);
        if (productIndex !== -1) {
          products[productIndex].stock = quantity;
          showNotification(
            "Mahsulot qoldig'i muvaffaqiyatli yangilandi!",
            "success"
          );
        }

        saveData();
        updateStockModal.classList.add("hidden");
        renderProducts(searchInput.value);
        renderStock(stockSearchInput.value);
        updateDashboard();
      }

      // Qarzdorlikni to'lash
      function payDebt() {
        const id = parseInt(payDebtId.value);
        const payment = parseFloat(payDebtPayment.value);

        if (isNaN(payment) || payment <= 0) {
          showNotification(
            "Iltimos, to'g'ri to'lov miqdorini kiriting!",
            "danger"
          );
          return;
        }

        const debtorIndex = debtors.findIndex((d) => d.id === id);
        if (debtorIndex === -1) return;

        const debtor = debtors[debtorIndex];

        if (payment > debtor.amount) {
          showNotification(
            `To'lov miqdori qarzdan ko'p bo'lishi mumkin emas!`,
            "danger"
          );
          return;
        }

        // Qarzdorlik to'langanda sotuvlar tarixiga "Naqd" deb qo'shish
        salesHistory.push({
          id: Date.now(),
          items: [
            {
              name: `Qarz to'lovi - ${debtor.firstname} ${debtor.lastname}`,
              price: payment,
              quantity: 1,
              unit: "to'lov",
              type: "payment",
            },
          ],
          total: payment,
          paymentMethod: "Naqd", // Qarzdorlik to'langanda "Naqd" deb ko'rsatish
          date: new Date().toLocaleString(),
        });

        if (payment === debtor.amount) {
          // Qarzni to'liq to'lash
          debtors.splice(debtorIndex, 1);
          showNotification(
            `${debtor.firstname} ${debtor.lastname}ning qarzi to'liq to'landi!`,
            "success"
          );
        } else {
          // Qarzni qisman to'lash
          debtors[debtorIndex].amount -= payment;
          showNotification(
            `${debtor.firstname} ${debtor.lastname}ning qarzi qisman to'landi!`,
            "success"
          );
        }

        saveData();
        payDebtModal.classList.add("hidden");
        renderDebtors(debtorsSearchInput.value);
        renderReports(salesDateFilter.value, paymentTypeFilter.value);
        updateDashboard();
      }

      // Mahsulotni o'chirish
      function deleteProduct(productId) {
        if (!confirm("Haqiqatan ham bu mahsulotni o'chirib tashlamoqchimisiz?"))
          return;

        const productIndex = products.findIndex((p) => p.id === productId);
        if (productIndex !== -1) {
          products.splice(productIndex, 1);
          showNotification("Mahsulot muvaffaqiyatli o'chirildi!", "info");

          saveData();
          renderProducts(searchInput.value);
          renderStock(stockSearchInput.value);
          updateDashboard();
        }
      }

      // Qarzdorni o'chirish
      function deleteDebtor(debtorId) {
        if (!confirm("Haqiqatan ham bu qarzdorni o'chirib tashlamoqchimisiz?"))
          return;

        const debtorIndex = debtors.findIndex((d) => d.id === debtorId);
        if (debtorIndex !== -1) {
          debtors.splice(debtorIndex, 1);
          showNotification("Qarzdor muvaffaqiyatli o'chirildi!", "info");

          saveData();
          renderDebtors(debtorsSearchInput.value);
          updateDashboard();
        }
      }

      // Xaridni naqd yakunlash
      function completeCashSale() {
        if (cart.length === 0) {
          showNotification("Savat bo'sh!", "warning");
          return;
        }

        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        salesHistory.push({
          id: Date.now(),
          items: [...cart],
          total,
          paymentMethod: "Naqd",
          date: new Date().toISOString(),
        });

        cart = [];
        saveData();
        renderCart();
        renderProducts(searchInput.value);
        renderReports(salesDateFilter.value, paymentTypeFilter.value);
        updateDashboard();

        showNotification(
          `Xarid naqd yakunlandi! Jami: ${total.toLocaleString()} UZS`,
          "success"
        );
      }

      // Qarzdorlik bilan xaridni yakunlash
      function completeDebtSale() {
        const firstname = debtorFirstname.value.trim();
        const lastname = debtorLastname.value.trim();
        const phone = debtorPhone.value.trim();
        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        if (!firstname || !lastname || !phone) {
          showNotification(
            "Iltimos, qarzdor ma'lumotlarini to'ldiring!",
            "warning"
          );
          return;
        }

        if (!/^\+?\d{9,12}$/.test(phone)) {
          showNotification("Telefon raqami noto'g'ri formatda!", "warning");
          return;
        }

        salesHistory.push({
          id: Date.now(),
          items: [...cart],
          total,
          paymentMethod: "Qarzdorlik",
          date: new Date().toLocaleString(),
        });

        debtors.push({
          id: Date.now(),
          firstname,
          lastname,
          phone,
          amount: total,
          date: new Date().toLocaleString(),
        });

        cart = [];
        debtorFirstname.value = "";
        debtorLastname.value = "";
        debtorPhone.value = "";
        debtForm.classList.add("hidden");

        saveData();
        renderCart();
        renderReports(salesDateFilter.value, paymentTypeFilter.value);
        renderDebtors(debtorsSearchInput.value);
        updateDashboard();

        showNotification(
          `Xarid qarzdorlik bilan yakunlandi! Jami: ${total.toLocaleString()} UZS`,
          "success"
        );
      }

      // Bildirishnoma ko'rsatish
      function showNotification(message, type = "info") {
        const container = document.getElementById("notification-container");
        const notification = document.createElement("div");

        let bgColor, icon;

        switch (type) {
          case "success":
            bgColor = "bg-success";
            icon = "fas fa-check-circle";
            break;
          case "warning":
            bgColor = "bg-warning";
            icon = "fas fa-exclamation-triangle";
            break;
          case "danger":
            bgColor = "bg-danger";
            icon = "fas fa-times-circle";
            break;
          default:
            bgColor = "bg-info";
            icon = "fas fa-info-circle";
        }

        notification.className = `${bgColor} text-white p-4 rounded-lg shadow-lg notification max-w-md`;
        notification.innerHTML = `
        <div class="flex items-center">
          <i class="${icon} text-xl mr-3"></i>
          <p>${message}</p>
          <button onclick="this.parentElement.parentElement.classList.add('slide-out'); setTimeout(() => this.parentElement.parentElement.remove(), 300)" class="ml-auto text-white">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;

        container.appendChild(notification);
        setTimeout(() => {
          notification.classList.add("slide-out");
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      }

      // Sana va vaqtni formatlash (yangilangan)
      function formatDateTime(dateString) {
        const date = new Date(dateString);
        const options = {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        };
        return date.toLocaleString('uz-UZ', options);
      }

      // Chop etish
      function printSaleDetails() {
        window.print();
      }

      // Ma'lumotlarni saqlash
      function saveData() {
        localStorage.setItem("products", JSON.stringify(products));
        localStorage.setItem("salesHistory", JSON.stringify(salesHistory));
        localStorage.setItem("debtors", JSON.stringify(debtors));
      }

      // Event Listeners
      document.addEventListener("DOMContentLoaded", function () {
        // Dastlabki render
        showSection("home");
        renderProducts();
        renderCart();
        renderStock();
        renderReports();
        renderDebtors();
        updateDashboard();

        // Qidiruv
        searchInput.addEventListener("input", () => {
          renderProducts(searchInput.value);
        });

        stockSearchInput.addEventListener("input", () => {
          renderStock(stockSearchInput.value);
        });

        debtorsSearchInput.addEventListener("input", () => {
          renderDebtors(debtorsSearchInput.value);
        });

        // Modallarni yopish
        closeProductModalBtn.addEventListener("click", () => {
          productModal.classList.add("hidden");
        });

        cancelProductBtn.addEventListener("click", () => {
          productModal.classList.add("hidden");
        });

        closeUpdateStockModalBtn.addEventListener("click", () => {
          updateStockModal.classList.add("hidden");
        });

        cancelStockUpdateBtn.addEventListener("click", () => {
          updateStockModal.classList.add("hidden");
        });

        closeSaleDetailsModalBtn.addEventListener("click", () => {
          saleDetailsModal.classList.add("hidden");
        });

        closeSaleDetailsBtn.addEventListener("click", () => {
          saleDetailsModal.classList.add("hidden");
        });

        closePayDebtModalBtn.addEventListener("click", () => {
          payDebtModal.classList.add("hidden");
        });

        cancelDebtPaymentBtn.addEventListener("click", () => {
          payDebtModal.classList.add("hidden");
        });

        // Mahsulot saqlash
        saveProductBtn.addEventListener("click", saveProduct);

        // Qoldiqni yangilash
        saveStockUpdateBtn.addEventListener("click", updateStock);

        // Qarzdorlikni to'lash
        completeDebtPaymentBtn.addEventListener("click", payDebt);

        // Chop etish
        printSaleBtn.addEventListener("click", printSaleDetails);

        // Xaridni yakunlash
        payCashBtn.addEventListener("click", completeCashSale);

        // Qarzdorlik formasini ochish/yopish
        payDebtBtn.addEventListener("click", () => {
          if (cart.length === 0) {
            showNotification("Savat bo'sh!", "warning");
            return;
          }
          debtForm.classList.toggle("hidden");
        });

        // Qarzdorlik bilan xaridni yakunlash
        completeDebtSaleBtn.addEventListener("click", completeDebtSale);

        // Hisobot filtrlari
        salesDateFilter.addEventListener("change", () => {
          renderReports(salesDateFilter.value, paymentTypeFilter.value);
        });

        paymentTypeFilter.addEventListener("change", () => {
          renderReports(salesDateFilter.value, paymentTypeFilter.value);
        });

        // Mahsulot qo'shish modali
        openProductModalBtn.addEventListener("click", openProductModal);

        // Mahsulot turi o'zgartirilganda hajm/og'irlik maydonini ko'rsatish/yashirish
        modalProductType.addEventListener("change", function () {
          if (this.value === "drink") {
            volumeContainer.classList.remove("hidden");
            weightContainer.classList.add("hidden");
          } else if (this.value === "snacks") {
            weightContainer.classList.remove("hidden");
            volumeContainer.classList.add("hidden");
          } else {
            volumeContainer.classList.add("hidden");
            weightContainer.classList.add("hidden");
          }
        
        });
      });
    </script>
    <script>
      const loginScreen = document.getElementById("login-screen");
      const loginError = document.getElementById("login-error");
    
      function login() {
        const username = document.getElementById("login-username").value.trim();
        const password = document.getElementById("login-password").value.trim();
    
        if (username === "Yumarket" && password === "javohir98") {
          sessionStorage.setItem("isLoggedIn", "true");
          loginScreen.classList.add("hidden");
        } else {
          loginError.classList.remove("hidden");
        }
      }
    
      window.addEventListener("DOMContentLoaded", () => {
        const loggedIn = sessionStorage.getItem("isLoggedIn");
        if (loggedIn === "true") {
          loginScreen.classList.add("hidden");
        }
      });
      window.addEventListener("popstate", function (event) {
  if (event.state && event.state.section) {
    showSection(event.state.section);
  }
});
function formatDateTime(dateString) {
  const date = new Date(dateString);
  const options = {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  };
  return date.toLocaleString('uz-UZ', options);


  const firebaseConfig = {
    apiKey: "AIzaSyAqywYAyesN2fOpKF2efyVUa3O_yFXH2ZQ",
    authDomain: "khamidxvl-8b061.firebaseapp.com",
    databaseURL: "https://khamidxvl-8b061-default-rtdb.firebaseio.com",
    projectId: "khamidxvl-8b061",
    storageBucket: "khamidxvl-8b061.appspot.com",
    messagingSenderId: "951770839143",
    appId: "1:951770839143:web:81c837351c2ce3d2b13cc2"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

}
function deleteProduct(productId) {
  const confirmDelete = confirm("Ushbu mahsulotni oâ€˜chirishni istaysizmi?");
  if (!confirmDelete) return;

  firebase.database().ref("products/" + productId).remove()
    .then(() => {
      showNotification("Mahsulot oâ€˜chirildi âœ…");
    })
    .catch((error) => {
      alert("Xatolik: " + error.message);
    });
}


    </script>
   <!-- <script>
      // Firebase sozlamalari
      var firebaseConfig = {
  apiKey: "AIzaSyAqwyX4YesNZf0pKF2efyVUa3o_yFXHZ2Q",
  authDomain: "kha midxvl-8b061.firebaseapp.com",
  databaseURL: "https://khamidxvl-8b061-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "khamidxvl-8b061",
  storageBucket: "khamidxvl-8b061.appspot.com",
  messagingSenderId: "951770839143",
  appId: "1:951770839143:web:81c837351c2ce3d2b13cc2"
};

    
      // Firebaseâ€™ni ishga tushirish
      firebase.initializeApp(firebaseConfig);
      var db = firebase.database();
    
      // Test mahsulot qoâ€˜shish
      var testProduct = {
        name: "Non",
        price: 5000,
        stock: 100,
        unit: "sanoq",
        type: "Oziq-ovqat"
      };
    
      // Firebaseâ€™ga yozish
      db.ref("products").push(testProduct);
    
      // Oâ€˜qish (logda koâ€˜rsatish)
      db.ref("products").once("value").then(function(snapshot) {
        console.log("Mahsulotlar:", snapshot.val());
      });
    </script>
    <script>
      // Test mahsulot
      var testProduct = {
        name: "Non",
        price: 5000,
        stock: 100,
        unit: "sanoq",
        type: "Oziq-ovqat"
      };
    
      // Firebaseâ€™ga yozish
      db.ref("products").push(testProduct).then(() => {
        console.log("âœ… Mahsulot qoâ€˜shildi:", testProduct);
      });
    
      // Firebaseâ€™dan oâ€˜qish
      db.ref("products").once("value").then(snapshot => {
        console.log("ðŸ“¦ Mahsulotlar roâ€˜yxati:", snapshot.val());
      });
    </script> -->
  </body>
</html>